$ bndry_layer = 0.01

Header
  Mesh DB "." "channel"
End
Simulation
  Coordinate System = Cartesian 2D
  Max Output Level = 3

  Simulation Type = Steady
  Steady State Max Iterations  = 2000

  Initialize Dirichlet Conditions =Logical False

  Post File = "Step_small.ep"
  Output File = a.d
  Output Intervals = 10
! Restart File = a.d
! Restart Position = 0
End


Body 1
  Name  = "Flow"
  Equation  = 1
  Material  = 1
  Initial Condition = 1
End


Body 2
  Name  = "Flow1"
  Equation = 1
  Material = 1
  Initial Condition = 1
End


Initial Condition 1
  Velocity 1 = Variable Coordinate 2
    Real MATC "20*tx"

  Velocity 2 = 0

  V2 = Variable Coordinate 2
    Real MATC "tx"

  F  = Variable Coordinate 2
    Real MATC "tx"

  Kinetic Energy = Variable Coordinate 2
    Real MATC "5*tx"

  Kinetic Dissipation = Variable Coordinate 2
    Real MATC "50*tx"
End


Solver 1
  Equation = V2-F

  Procedure = "V2FSolver" "V2FSolver"
  Variable = V2F[V2:1 F:1]
 
  Stabilization Method = String Bubbles
  Nonlinear System Max Iterations = 1
  Nonlinear System Convergence Tolerance = 1.0e-5
  Nonlinear System Newton After Iterations = 20
  Nonlinear System Newton After Tolerance = 1.0e-3
  Nonlinear System Relaxation Factor = 0.5

  Linear System Solver = Direct
  Linear System Direct Method = UMFPack
  Linear System Max Iterations = 1000
  Linear System Iterative Method = BiCGStab
  Linear System Preconditioning = ILU0
  Linear System Convergence Tolerance = 1.0e-7

  Steady State Convergence Tolerance = 1.0e-4
End

Solver 2
  Equation = Kepsilon

  Procedure = "KESolver" "KESolver"
  Variable = KEpsilon[Kinetic Energy:1 Kinetic Dissipation:1]
 
  Nonlinear System Max Iterations = 1
  Nonlinear System Convergence Tolerance = 1.0e-5
  Nonlinear System Newton After Iterations = 20
  Nonlinear System Newton After Tolerance = 1.0e-3
  Nonlinear System Relaxation Factor = 0.1

  Linear System Solver = Direct
  Linear System Direct Method = UMFPack
  Linear System Max Iterations = 1000
  Linear System Iterative Method = BiCGStab
  Linear System Preconditioning = ILU0
  Linear System Convergence Tolerance = 1.0e-7

  Steady State Convergence Tolerance = 1.0e-4
End

Solver 3
  Equation = Navier-Stokes

  Stabilization Method = String Bubbles
  Nonlinear System Max Iterations = 1
  Nonlinear System Convergence Tolerance = 1.0e-5
  Nonlinear System Newton After Iterations = 10
  Nonlinear System Newton After Tolerance  = 1.0e-3
  Nonlinear System Relaxation Factor = 0.8

  Linear System Solver = Direct
  Linear System Direct Method = UMFPack
  Linear System Max Iterations = 1000
  Linear System Iterative Method = BiCGStabL
  Linear System Preconditioning = ILU2
  Linear System Convergence Tolerance = 1.0e-7

  Steady State Convergence Tolerance = 1.0e-4
End

Solver 4
  exec solver = after simulation
  Equation = SaveLine
  Procedure = "SaveData" "SaveLine"
  Filename = "curve.dat"
End


Equation 1 :: Active Solvers(3) = 1 2 3


Material 1
  Viscosity = $ 1/395
  Density = 1

  KE CMu = Real 0.22
  V2-F CT = real 6

  KE Model = "V2-F"
  Viscosity Model = ke
  KE Clip = Real 1.0e-12
End
 

Boundary Condition 1
  Target Boundaries = 1

  Flow Force BC = True
  Velocity 2 = 0
  Pressure 1 = Real 32
End


Boundary Condition 2
  Target Boundaries = 2

  Periodic BC = 1
  Periodic BC Velocity 1 = Logical True
  Periodic BC Velocity 2 = Logical True
  Periodic BC V2 = Logical True
  Periodic BC F  = Logical True
  Periodic BC Kinetic Energy = Logical True
  Periodic BC Kinetic Dissipation = Logical True

  Pressure   = 0
  Velocity 2 = 0
  Save Line = Logical True
End

Boundary Condition 3
  Target Boundaries = 3
  Velocity 2 = 0
End

Boundary Condition 4
  Target Boundaries = 4

  Velocity 1 = 0
  Velocity 2 = 0

  f  = Real 0.0
  V2 = Real 0.0
  Kinetic Energy = 0

  Kinetic Dissipation = Variable Kinetic Dissipation
    Real Procedure "Epsilon-BC" "Epsilon"
  Epsilon Relax = Real 0.25
End

$fprintf( stderr, "TEST CASE 1\n");
RUN
$fprintf( stderr, "END TEST CASE 1: Target NRM=6.81503326667\n" );

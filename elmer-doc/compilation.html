
<html>
<head><title></title></head>

<body>
<h1>Compilation instructions</h1>

<h2>Quick start</h2>

<p>
Make sure you have a working blas, lapack and umfpack that work with
your compiler (the configure scripts will tell you if something is
wrong). Then pick an installation directory, I recommend something
like: /opt/elmer, ~/elmer or /usr (default). Then compile the elmer source
packages in the following order: matc, mathlibs, elmergrid, meshgen2d,
eio, hutiter, fem using the normal procedure of ./configure ; make ;
make install, or use the following convenience script:
</p>

<pre>
#!/bin/sh -f
#
# Fetch sources from CVS, compile each module and install it
#
export CVSROOT="anonymous@cvs.csc.fi:/elmer"
export CVS_RSH="ssh"

modules="matc mathlibs elmergrid meshgen2d eio hutiter fem" 
cvs co $modules
for m in $modules; do 
   cd $m ; ./configure --prefix=/opt ; make; make install ; cd .. 
done
</pre>

<p>
If you don't want to use the CVS, alternatively untar source tarballs
and compile them in a similar manner (unpack, ./configure ; make ;
make install)
</p>

<h2>Step by step instructions</h2>

<p>First, check out the list of supported platforms and compilers to
get a feeling of the chances you have of compiling Elmer. If your
platform and compiler isn't listed, there is a chance that you won't
be able to compile Elmer.</p>

<p>
Mathlibs contains netlib BLAS, LAPACK, ARPACK and PARPACK. To install
only seperate parts, eg., say only ARPACK, because you have a faster
BLAS and LAPACK, do a normal configure, and then: 
</p>

<pre>
> cvs co mathlibs  
> cd mathlibs ; ./configure
> cd src/arpack ; make ; make install.
</pre>



<h2>Specifying libraries</h2>

<p>
If you want to specify your own blas and lapack, you can eg.
</p>

<pre>
> ./configure --with-blas="~/lib/libblas.a"!
</pre>

<p>
or use the environment variable:
</p>

<pre>
> BLAS_LIBS="-L/some/convoluted/path/lib -lblas3.1.03"!
</pre>

<p>
a similar procedure works for most of the libraries that are detected
using 
</p>

<h2>Testing the build</h2>

<p>
The fem module contains a set of tests that can be used to test that
the solver really works. The tests can be invoked with <code>make
check</code>:
</p>

<pre>
> cd fem
> make check
-- cut --
testing:               1dtests                  [PASSED]
testing:               1sttime                  [PASSED]
testing:               2ndtime                  [PASSED]
-- cut --
testing:           streamlines                  [PASSED]
testing:       ThermalCompress                  [PASSED]
testing:             TimeAdapt                  [PASSED]
Tests completed, passed: 52 out of total 52 tests
</pre>

<p>but also seperately from the tests subdirectory of the fem
module using the runtests script:</p>

<pre>
> cd fem/tests
> ./runtests PoissonBEM
$ELMER_HOME undefined, setting it to ../src
testing:           PoissonBEM                  [PASSED]
Tests completed, passed: 1 out of total 1 tests
</pre>

<p>If a test fails, a test.log file will be left in the test directory
for debugging purposes.</p>

<h2>MPI</h2>

<p>
There are two packages that need special care, if you intend to use
the MPI version of elmer: mathlibs (parpack) and fem. If the mpi
libraries are not in a trivial place (/usr/lib), then you will need
specify the location to the configure script. For this purpose there
are several command line arguments provided: 
</p>

<pre>
--with-mpi-dir            # Specify a dir that contains lib/, include/ and bin/
--with-mpi-lib-dir	  # Specify location of libmpi.{a|so}* or libmpich.{a|so} 
--with-mpi-inc-dir	  # Specify location of mpif.h
--with-mpi-bin-dir	  # Specify location of mprun
</pre>

<p>
Usually, the --with-mpi-dir will suffice, eg. on Sun:
</p>

<pre>
./configure --with-mpi-dir=/opt/SUNWhpc/
</pre>

<p>
But sometimes there is a tricky situation (in this case, for 64 bit
mpi libs), and you will need something like this:
</p>

<pre>
./configure --with-mpi-lib-dir=/opt/SUNWhpc/lib/sparcv9 \
	     --with-mpi-inc-dir=/opt/SUNWhpc/include/v9 
</pre>

<p>
A good way to look for MPI library directory is to `locate libmpi` or
compiling a simple test program with mpf90 (if provided) with verbose
compilation options to see which directories and libraries are used.
</p>

<h3>Testing MPI</h3>

<p>There are many different MPI environments, so it is difficult to
give a set of commands.</p>

<p>Basic MPICH2 style test</p>

<pre>
> cd tests/heateq-par
> mpirun -np 2 ../../src/ElmerSolver_mpi 
</pre>


<p>On IBM, the solver executable is linked with mpxlf90, so no
mpirun/mprun is needed</p>

<pre>
> ../../src/ElmerSolver_mpi -nprocs 4 -pfile hosts.lst
</pre>

<h2>Common errors</h2>

- blas not found
- lapack not found
- mpi fucked
- umfpack fucked

<h2>Compilers known to work</h2>

<p>
<table class="elmerTable">
  <tr><td class="tableHead">Compiler</td><td class="tableHead">Remarks</td></tr>
  <tr><td>GNU (gcc, g++, g77, <a href="http://g95.sf.net">g95</a>)</td><td>ok</td></tr>
  <tr><td>Intel (icc, ifort)</td><td>ok</td></tr>
  <tr><td>Pathscale (pathcc, pathCC, pathf90)</td><td>ok</td></tr>
  <tr><td>Absoft</td><td>barely compiles</td></tr>
  <tr><td>Sun Studio</td><td>ok</td></tr>
  <tr><td>XL Fortran</td><td>ok</td></tr>
</table>
</p>

<p>
A good rule is to try compiling everything with compilers of the same
vendor. The only exception is maybe ifort and pathscale, which work
fairly well together with the gnu c and c++ compilers.
</p>

<h2>Platforms known to work</h2>

<p>Elmer has been known to compile and function on the following platforms:</p>

<p>
<table class="elmerTable">
  <tr><td class="tableHead">OS</td><td class="tableHead">Architecture</td><td class="tableHead">Working modules</td></tr>
  <tr><td>Linux</td><td>x86, x86-64</td><td>S,P,F</td></tr>
  <tr><td>Sun Solaris</td><td>sparcv7, sparcv9</td><td>S,P,F</td></tr>
  <tr><td>IBM AIX</td><td>PPC</td><td>S</td></tr>
  <tr><td>Apple OS X 10.3</td><td>PPC</td><td>S,P</td></tr>
</table>
<p>Legend: S=Solver P=Post F=Front</p>
</p>




</body>
</html>


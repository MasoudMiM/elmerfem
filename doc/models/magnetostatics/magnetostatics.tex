\Chapter{Magnetostatics}
\noindent
\modinfo{Module name}{StatMagSolve}
\modinfo{Module subroutines}{\Idx{StatMagSolver}}
\begin{versiona}
\modinfo{Module authors}{Juha Ruokolainen, Ville Savolainen, Jussi Heikonen, Peter Råback, Antti Pursula}
\modinfo{Document authors}{Ville Savolainen, Peter Råback, Antti Pursula}
\modinfo{Document edited}{June 29th 2006}

\section{Introduction}

The Maxwell's equations may generally be expressed with 
a scalar and a vector potential. The magnetic field is then
the curl of the vector potential. In some cases the scalar potential vanishes
and the system is fully described by the vector potential. These
cases includes magnetostatics and time-harmonic induction at low frequencies.

Magnetostatics\index{magnetostatics} describes the time-independent magnetic
fields. The magnetic field may be created by electromagnets with given current
distributions or permanent ferromagnets. This solver allows the first option,
with non-homogeneous and non-linear magnetic materials. 

In some cases the current density varies sinusoidally with time.
If the field varies slowly and there are no conductors in the system
the problem is described with the stationary model. However, in conductors the
magnetic field results in additional currents that make the equation
complex.

%%Currently only an axisymmetric version of the solver is provided.



\section{Theory}

When there are no hard ferromagnets, the magnetostatics problems may be
expressed with magnetic vector potential $\vec{A}$ that satisfies
$\vec{B} = \nabla\times\vec{A}$. It is obtained directly
from the Amp\`{e}re's law, with displacement current ignored, that
\[
\nabla \times \left(\frac{1}{\mu} \nabla \times \vec{A} \right) = \vec{\jmath}.
\]
Here $\mu$ is the magnetic permeability of the material. The equation may be
non-linear through the magnetic permeability curve of a ferromagnetic material.
The magnetic permeability is specified in the {\tt Material} section by the
keyword {\tt Magnetic Permeability}.

The equation above may be solved either in axial symmetry or in three
dimensions. In 3D, a curl vector identity is used to transform the
equation into the form
\[
-\frac{1}{\mu} \nabla^2\vec{A} = \vec{\jmath},
\]
which is valid when $\mu$ is not a function of space
coordinates. Also, the vector potential $\vec{A}$ is {\em a priori}
assumed to satisfy the Coulomb gauge ($\nabla\cdot\vec{A}=0$).


If there are conductors in the system the electric field is obtained
from 
\[
  \vec{E} = \sigma \Der{\vec{A}}{t},
\]
where $\sigma$ is the electrical conductivity. In time-harmonic case 
the current density is sinusoidal
  $\vec{\jmath} = \vec{\jmath}_0 e^{i \omega t}$,
where $\omega=2\pi f$ is the angular frequency.
Using a trial $\vec{A}=\vec{A}_0 e^{i \omega t}$ we obtain an equation
for the amplitude
\[
\nabla \times \left(\frac{1}{\mu} \nabla \times \vec{A}_0 \right) 
+ i \omega \sigma \vec{A}_0 = \vec{\jmath}_0.
\]

If the geometry is axisymmetric, then the magnetic flux density $\vec{B}$ has
only $r$- and $z$-components, and the current density $\vec{\jmath}$ and the
vector potential $\vec{A}$ only $\phi$-components, and
\begin{equation}
\nabla \times \left(\frac{1}{\mu} \nabla \times A_{\phi}\vec{e}_{\phi}\right)
+ i \omega \sigma A_{\phi}\vec{e}_{\phi} =j_{\phi}\vec{e}_{\phi}.\label{magnetostatic}
\end{equation}
The current density is given as a body force with the keyword {\tt Current
Density}. The vector potential satisfies now automatically the Coulomb gauge.

In stady state case $A_\phi$ is real and there is only one unknown.
In the harmonic case the equation has two unknowns 
-- the in-phase and the out-of-phase component of
the vector potential. After solution the heat generation in the conductors
may be computed from 
\[
  h = \frac{1}{2} \sigma \omega^2 | \vec{A}_0 |^2 .
\]

The magnetic flux density is calculated as a post-processing step from the
vector potential. Both the vector potential and the magnetic flux density
components are written in the result and ElmerPost files. The variable names
in the result file are {\tt magnetic vector potential} and {\tt magnetic flux
density 1}, {\tt 2} and {\tt 3}.

By definition, magnetostatics deals with steady-state problems. However, the
problem may be solved nominally time-dependent. This merely means that it is
solved for a set of given current densities.

\subsection{Boundary Conditions}

For the magnetostatics equation one can apply either Dirichlet or natural
boundary conditions. In both cases, one must check that the computational
domain is extended far enough to avoid numerical errors.

The \Idx{Dirichlet boundary condition} for $A_\phi$ is
\begin{equation}
A_\phi = A_\phi^b.
\end{equation}
In practice, when Dirichlet condition is used, usually $A_\phi^b=0$.
The keyword for the Dirichlet boundary condition is
{\tt Magnetic Vector Potential}. If Dirichlet condition is not specified,
natural boundary condition is used.

\section{Keywords} 
\end{versiona}

\sifbegin
\sifitem{Solver}{solver id} 
Note that all the keywords related to linear solver (starting with {\tt Linear System}) 
may be used in this solver as well.
They are defined elsewhere. 

\sifbegin
\sifitem{Equation}{String [Static Magnetic Field]} 
The name of the equation.
\sifitem{Variable}{String [Magnetic Vector Potential]}
The name of the variable.
\sifitem{Procedure}{File ["StatMagSolve"\ "StatMagSolver"]}
The name of the file and subroutine.
\sifitem{Calculate Magnetic Flux}{Logical [True]}
In large computations the automatic computation of the magnetic flux may be turned off
by this keyword. The default is \texttt{True}.
\sifitem{Calculate Joule Heating}{Logical [True]}
In large computations the automatic computation of the Joule heating may be turned off
by this keyword. The default is \texttt{True}. The keyword is only applicable 
for the harmonic case. The computation results to two additional 
variables. \texttt{Joule Heating} gives the absolute heating and 
\texttt{Joule Field} the field that gives the heating when multiplied
by the electric conductivity. This may be needed if the electric conductivity is 
discontinuous making also the heating power discontinuous. 
\sifitem{Desired Heating Power}{Real}
A constant that gives the desired total heating power in Watts. If the keyword is active
the the \texttt{Joule Heating} and \texttt{Joule Field} are multiplied by the ratio of
the desired and computed heating powers.
\sifitem{Nonlinear System Convergence Tolerance}{Real} This keyword gives a criterion to
terminate the nonlinear iteration after the relative change of the norm of the field variable
between two consecutive iterations $k$ is small enough
$$
 ||A_\phi^k-A_\phi^{k-1}|| < \epsilon ||A_\phi^k||,
$$
where $\epsilon$ is the value given with this keyword.
\sifitem{Nonlinear System Max Iterations}{Integer} 
The maximum number of nonlinear iterations the
solver is allowed to do. If neither the material parameters nor the boundary
conditions are functions of the solution the problem is linear,
this should be set to 1.
\sifitem{Nonlinear System Relaxation Factor}{Real} Giving this keyword triggers the use
of  relaxation in the nonlinear equation solver.
Using a factor below unity is sometimes required to achive convergence of the nonlinear system.
A factor above unity might speed up the convergence. Relaxed variable is defined as follows:
$$
 A_\phi^{'} = \lambda A_\phi^k + (1-\lambda) A_\phi^{k-1},
$$
where $\lambda$ is the factor given with this keyword. The default value for the relaxation factor
is unity.
\sifend

\sifitem{Equation}{eq id}
The equation section is used to define a set of equations for a body or set of bodies:
\sifbegin
\sifitem{Static Magnetic Field}{Logical} If set to {\tt True}, solve the
magnetostatics equation.
%\sifitem{User Defined Velocity}{Logical} If set to {\tt True} uses a
%given velocity instead of the computed velocity. The values of the
%velocity may be given in the {\tt Material} section.
\sifend

\sifitem{Body Force}{bf id}
The body force section may be used to give additional force terms for the equations.
\sifbegin
\sifitem{Current Density}{Real} Specifies the azimuthal component of the
current density. May be a positive or negative constant or a function of a
given variable.
\sifitem{Current Phase Angle}{Real} Specifies the phase angle of the current
density in degrees. The default phase angle is zero. Applies only to the 
time-harmonic case.
\sifend

\sifitem{Initial Condition}{ic id} 
The initial condition section may be used to set initial values for the field
variables. The following variable is active:
\sifbegin
\sifitem{Magnetic Vector Potential}{Real} 
The azimuthal component of the magnetic vector potential.
\sifend

\sifitem{Material}{mat id}
The material section is used to give the material parameter values. 
Material parameter available for the magnetostatics equation are.
\sifbegin
\sifitem{Magnetic Permeability}{Real} The magnetic permeability $\mu$ is set
with this keyword, defining the material relation $\vec{B}=\mu\vec{H}$.
The magnetic permeability may be a constant (default is $4\pi 10^{-7}$) 
or a function of a given variable,
typically given by the relation $\mu=\mu(|\vec{B}|)$. The value of the
magnetic flux density $|\vec{B}|$ is available by the variable named.
{\tt Absolute Magnetic Flux}.
\sifitem{Electrical Conductivity}{Real} 
The electrical conductivity defines the relation $\vec{\jmath}=\sigma \vec{E}$.
Only isotropic case is possible.
The parameter is needed only in the time-harmonic case.
%\sifitem{MHD Velocity i}{Real}
%The components of the user defined velocity with \texttt{i=1,2,3}.
\sifend

\sifitem{Boundary Condition}{bc id}
The boundary condition section holds the parameter values for various
boundary condition types. Dirichlet boundary condition may be
set for the vector potential. The one related to the the axisymmetric
magnetostatics problem is
\sifbegin
\sifitem{Magnetic Vector Potential}{Real} 
The azimuthal component of the magnetic vector potential.
\sifend

\sifend



%\bibliography{elmerbib}
%\bibliographystyle{plain}

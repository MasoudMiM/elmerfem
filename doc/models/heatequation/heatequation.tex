\chapter{Heat Equation}

\modinfo{Module name}{included in solver}
\modinfo{Module subroutines}{\Idx{HeatSolve}}

\begin{versiona}
\modinfo{Module authors}{Juha Ruokolainen}
\modinfo{Document authors}{Juha Ruokolainen, Ville Savolainen}
\modinfo{Document edited}{July 29th 2002}


\section{Introduction}

Heat equation results from the requirement of \Idx{energy conservation}.
In addition the Fourier's law is used to model
the heat conduction. The linearity of the equation may be 
ruined by temperature dependent thermal conductivity, or by
heat radiation.


\section{Theory}

\subsection{Governing Equations}
The incompressible heat equation is expressed as
\begin{equation}
\rho  c_p\left( \frac{\partial T}{\partial t}+(\vec u\cdot\nabla) T\right) - 
\nabla\cdot(k\nabla T) =
\overline{\overline\tau}:\overline{\overline \varepsilon} + \rho h,
\label{heat_equation}
\end{equation}
where $\rho$ is the density, $c_p$ the heat capacity at constant pressure, 
$T$ the temperature, $\vec u$ the convection velocity, $k$ the heat 
conductivity and $h$ is source of heat.
The term $\overline{\overline\tau}:\overline{\overline \varepsilon}$ is the
frictional viscous heating, which is negligible in most cases. For Newtonian
fluids, the viscous
part of the stress tensor is
\begin{equation}
\overline{\overline\tau} = 2\mu \overline{\overline\varepsilon},
\end{equation}
where $\overline{\overline \varepsilon}$ the linearized strain rate tensor.

Eq.\ref{heat_equation} applies also for solids, setting $\vec u = 0$. For
solids, conduction may be anisotropic and the conductivity a tensor.

For compressible fluids, the heat equation is written as
\begin{equation}
\rho c_v\left(\frac{\partial T}{\partial t} + \vec{u}\cdot\nabla T\right) -
\nabla\cdot\left(k\nabla T\right) = - p \nabla\cdot\vec{u} 
+ \overline{\overline\tau}:\overline{\overline \varepsilon}
+ \rho h,
\end{equation}
where $c_v$ is the heat capacity at constant volume. The density needs to be
calculated from the equation of state, e.g., perfect gas law. More
information is given in the chapter describing the Navier-Stokes equation.

The Elmer heat equation module is capable of simulation heat transfer by
conduction, convection, and diffuse gray radiation. Also a phase change
model is included. Couplings to other modules include, convection by
fluid flow, frictional heating (modules providing flow fields), and
resistive heating (modules providing magnetic and/or electric fields).


\subsection{Phase Change Model}

Elmer has an internal fixed grid phase change model. Modelling phase change is done
by modifying the definition of heat capacity according to whether
a point in space is in solid or liquid phase or in a 'mushy' region.
The choice of heat capacity within the intervals is explained in detail
below.

This type of algorithm is only applicable, when the phase change occurs
within finite temperature interval. If the modelled material is such that
the phase change occurs within very sharp temperature interval, this
method might not be appropriate.

For the solidification phase change model Elmer uses,  we need enthalpy.
The enthalpy is defined to be
\begin{equation}
H(T) = \int_0^T \left ( \rho c_p + \rho L\frac{\partial f}{\partial \lambda}\right )d\lambda,
\end{equation}
where $f(T)$ is the fraction of liquid material as a function of
temperature, and $L$ is the latent heat.
The enthalpy-temperature curve is used
to compute an effective heat capacity, whereupon the equations become identical
to the heat equation. There are two ways of computing the effective heat capacity in Elmer:
\begin{equation}
c_{p,\mathrm{eff}} = \frac{\partial H}{\partial T},
\end{equation}
and
\begin{equation}
c_{p,\mathrm{eff}} = \left ( \frac{\nabla H\cdot\nabla H}{\nabla T\cdot\nabla T}\right )^{1/2}.
\end{equation}
The former method is used only if the local temperature gradient is very small, while
the latter is the preferred method. In transient simulations a third method is used, given
by
\begin{equation}
c_{p,\mathrm{eff}} = \frac{\partial H/\partial t}{\partial T/\partial t}.
\end{equation}

\subsection{Additional Heat Sources}

Frictional heating is calculated currently, for both incompressible and 
compressible fluids, by the heat source
\begin{equation}
h_f = 2\mu\overline{\overline\varepsilon}:\overline{\overline\varepsilon}.
\end{equation}

In case there are currents in the media the also the 
the resistive heating may need to be considered.
The \Idx{Joule heating} is then given by
\begin{equation}
h_m = \frac{1}{\sigma} \vec J \cdot \vec J.
\end{equation}
In the above equations, $\vec B$ and $\vec E$ are the magnetic and electric
fields, respectively. The current density $\vec J$ is defined as
\begin{equation}
\vec J = \sigma(\vec E + \vec u\times \vec B).
\end{equation}


\subsection{Boundary Conditions}
For temperature one can apply boundary conditions and have either temperature 
or heat flux prescribed.

\Idx{Dirichlet boundary condition} (temperature is 
prescribed) reads as
\begin{equation}
T=T_b.
\end{equation}
\noindent The value  of $T_b$ can be constant or a function of time, position or 
other variables. 

Heat flux depending on heat transfer coefficient $\alpha$ and external
temperature $T_{\mathrm{ext}}$ may be written as
\begin{equation}
-k\frac{\partial T}{\partial n} =\alpha (T-T_{ext} ).
\end{equation}
Both variables $\alpha$ and $T_\mathrm{ext}$ can be constant or functions of time, 
position or other variables. If the heat transfer coefficient $\alpha$ is equal
to zero, it means that the heat flux on a boundary is identically zero. The 
\Idx{Neumann boundary condition} $-k\partial T/\partial n =0$ is also used in a 
symmetry axis in 2D, axisymmetric or cylindrical problems.

Heat flux can consist of idealized radiation whereupon
\begin{equation}
-k\frac{\partial T}{\partial n} =\sigma\varepsilon (T^4 -T^4_\mathrm{ext} ).
\label{radcondition}
\end{equation}
Above,  $\sigma$ is the \Idx{Stefan-Boltzmann constant} and $\varepsilon$ the 
surface emissivity. The emissivity and the external temperature can 
again be constant or functions of time, position, or other variables.

If the surface $k$ is receiving radiation from other surfaces in the system,
then the heat flux reads as
\begin{equation}
-k_k \frac{\partial T_k}{\partial n_k} = \sigma \varepsilon_k (T_k^4 -
{1\over {A_k \varepsilon_k}} \sum_{i=1}^N G_{ik} \varepsilon_i  T_i^4 A_i ),
\end{equation}
where the subscripts $i$ and $k$ refer to surfaces $i$ and $k$, and the parameters $A_i$ and
$A_k$ to the specific surface areas. The factors $G_{ik}$ are \Idx{Gebhardt factors}, and
$N$ represents the total number of radiating surfaces present in the system.
Emissivities are assumed to be constant on each surface.

The heat equation is nonlinear when radiation is modelled.
The nonlinear term in the boundary condition (\ref{radcondition})
can be linearized as
\begin{eqnarray}
T^4 - T^4_\mathrm{ext} \approx
( {\cal T}^3 + T_\mathrm{ext} {\cal T}^2  + T^2_\mathrm{ext} {\cal T} + 
T^3_\mathrm{ext} )( T-T_\mathrm{ext} ),
\end{eqnarray}
where $\cal{T}$ is the temperature from the previous iteration.

One may also give an additional heat flux term as
\begin{equation}
-k\frac{\partial T}{\partial n} = q.
\end{equation}


\section{Keywords} 
\end{versiona}


\sifbegin
\sifitemnt{Constants}{}
\sifbegin
\sifitem{Stefan Boltzmann}{Real}
The value of the Stefan-Boltzmann constant needed for 
thermal radiation.
\sifend

\sifitem{Simulation}{}
The simulation section gives the case control data:
\sifbegin
\sifitem{Simulation Type}{String} Heat equation may be either 
{\tt Transient} or {\tt Steady State}.
\sifitem{Coordinate System}{String} Defines the coordinate system to be used, one of:
{\tt Cartesian 1D}, {\tt Cartesian 2D},~ ~{\tt Cartesian 3D},~ ~{\tt Polar 2D},~ 
~{\tt Polar 3D},~ ~{\tt Cy\-lin\-dric},~ ~{\tt Cylindric Symmetric}~
~and~ ~{\tt Axi Symmetric}.
% These keywords have become obsolite and envoke the old style of view factor computation
%
%\sifitem {Gebhardt Factors}{File}
%If the model includes diffuse gray radiation, the file containing the Gebhardt factors
%must be given. This file is written by the program {\tt GebhardtFactors} as a preprocessing step.
%\sifitem{View Factors}{File} 
%If the model includes diffuse gray radiation, the file containing the view factors
%must be given to the program computing the Gebhardt factors. 
%This file is written by the program {\tt ViewFactors} as a
%preprocessing step. The tasks of computing view factors and the Gebhardt 
%factors have been divided, because
%the view factors depend only on geometry (and thus the mesh), while the Gebhardt factors also depend on
%the boundary emissivities. 
%
\sifitem{Timestepping Method}{String} 
Possible values of this parameter are {\tt Newmark} (an additional
parameter {\tt Newmark Beta} must be given), {\tt BDF} ({\tt BDF Order} must be given). Also as a
shortcut to {\tt Newmark}-method with values of {\tt Beta}$=0.0, 0.5,$ $1.0$ the keywords 
{\tt Explicit Euler}, {\tt Crank-Nicolson}, and {\tt Implicit Euler} may be given respectively.
The recommended choice for the first order time integration is the BDF method of order 2.
\sifitem{BDF Order}{Integer}
Value may range from 1 to 5.
\sifitem{Newmark Beta}{Real} Value in range from 0.0 to 1.0. The value 0.0 equals to
the explicit Euler integration method and the value 1.0 equals to the implicit Euler method. 
\sifend

\sifitem{Solver}{solver id}
The solver section defines equation solver control variables. Most of the possible
keywords -- related to linear algebra, for example -- are common for all the solvers and are 
explained elsewhere.
\sifbegin
\sifitem{Equation}{String Heat Equation}
The name of the equation.
\sifitem{Nonlinear System Convergence Tolerance}{Real}
The criterion to
terminate the nonlinear iteration after the relative change of the norm of the field variable
between two consecutive iterations is small enough
$$
 ||T_i-T_{i-1}|| < \epsilon ||T_i||,
$$
where $\epsilon$ is the value given with this keyword.
\sifitem{Nonlinear System Max Iterations}{Integer}
The maximum number of nonlinear iterations the
solver is allowed to do.
\sifitem{Nonlinear System Newton After Iterations}{Integer}
Change the nonlinear solver type to
Newton iteration after a number of Picard iterations have been performed. If a given
convergence tolerance between two iterations is met before the iteration count is met,
it will switch the iteration type instead. In the heat equation the Picard iterations 
means that the radiation term is factorized to linear and third-power terms.
\sifitem{Nonlinear System Newton After Tolerance}{Real}
Change the nonlinear solver type to
Newton iteration, if the relative change of the norm of the field variable meets a
tolerance criterion:
$$
 ||T_i-T_{i-1}|| < \epsilon ||T_i||,
$$
where $\epsilon$ is the value given with this keyword.
\sifitem{Nonlinear System Relaxation Factor}{Real}
Giving this keyword triggers the use
of  relaxation in the nonlinear equation solver.
Using a factor below unity is sometimes required to achieve convergence of the nonlinear system.
A factor above unity might speed up the convergence. Relaxed variable is defined as follows:
$$
 T^{'}_i = \lambda T_i + (1-\lambda) T_{i-1},
$$
where $\lambda$ is the factor given with this keyword. The default value for the relaxation factor
is unity.
\sifitem{Steady State Convergence Tolerance}{Real}
With this keyword a equation specific steady state or coupled system
convergence tolerance is given.
All the active equation solvers must meet their own tolerances before the 
whole system is deemed converged.
The tolerance criterion is:
$$
 ||T_i-T_{i-1}|| < \epsilon ||T_i||,
$$
where $\epsilon$ is the value given with this keyword.
\sifitem{Stabilize}{Logical} 
If this flag is set true the solver will use stabilized finite element method
when solving the heat equation with a convection term. If this flag is set to
{\tt False} RFB (Residual Free Bubble) stabilization is used instead (unless
the next flag {\tt Bubbles} is set to {\tt False} in a problem with Cartesian
coordinate system).
If convection dominates stabilization must be used in order to successfully solve the equation.
The default value is {\tt False}.
\sifitem{Bubbles}{Logical}
There is also a residual-free-bubbles formulation of the stabilized finite-element
method. It is more accurate and does not include any ad hoc terms. However, it may
be computationally more expensive. The default value is {\tt True}.
If both {\tt Stabilize} and {\tt Bubbles} or set to {\tt False}, no stabilization
is used. Note that in this case, the results might easily be nonsensical.
\sifitem{Smart Heater Control After Tolerance}{Real}
The smart heater control should not be activated before the 
solution has somewhat settled. By default the smart heater 
control is set on when the Newtonian linearization is 
switched on for the temperature equation. Sometimes
it may be useful to have more stringent condition for 
turning on the smart heater control and then this keyword
may be used to give the tolerance. 
%
\sifend
In some cases the geometry or the emissivities of the radiation boundaries 
change. This may require the recomputation of the \Idx{view factors} and 
\Idx{Gebhardt factors}. For that purpose also dynamic computation of the factors
is enabled and it is controlled by the keywords below.
The radiation factors are also automatically computed if
no files for the factors are given allthough radiation boundaries
exist. 
\sifbegin
\sifitem{Update View Factors}{Logical}
The recomputation of the view factors is activated by 
setting the value of this flag to \texttt{True}.
\texttt{False} is the default.
\sifitem{Update Gebhardt Factors}{Logical}
If the emissivities depend on the solution the Gebhardt factors may need to 
be recomputed. This is activated by setting giving this flag value \texttt{True}.
\texttt{False} is the default.
\sifitem{Minimum View Factor}{Real}
This keyword determines the cut-off value under which the view factors are
omitted. Neglecting small values will not only save memory but also will
make the matrix used for solving the Gabhardt factors less dense. 
This consequently will enable more efficient sparse matrix strategies
in solving the Gebhardt factors.
The value for this parameter might be of the order 10e-8. 
\sifitem{Minimum Gebhardt Factor}{Real}
The Gebhardt factors make part of matrix dense. By neglecting the smallest Gebhardt factors
the matrix structure for the heat equation 
may become significantly sparser and thus the solution time may drop.
The value for this parameter might also be of the order 10e-8. 
%
\sifitem{Implicit Gebhardt Factor Fraction}{Real}
In computing heat transfer problems with radiation in an implicit manner the matrix structure 
becomes partially filled. This affects the performance of the linear equation solvers
and also increases the memory requirements. On the other hand explicit treatment 
of radiation slows down the convergence significantly. This keyword allows
that the largest Gebhardt factors are treated in an implicit manner whereas
the smallest are treated explicitely. The value should lie in between 
zero (fully explicit) and one (fully implicit).
%
\sifitem{Matrix Topology Fixed}{Logical}
If the Gebhardt factors change the matrix structure of the heat equation
may also have to be changed unless this flag is set to \texttt{False}.
Then all factors that do not combine with the matrix structure are omitted.
\sifitem{View Factors Geometry Tolerance}{Real}
The view factors take a lot of time to compute. Therefore during the iteration a test is performed 
to check whether the geometry has changed. If the relative maximum change in the coordinate 
values is less than the value given by this parameter the view factors are not recomputed and
the old values are used. 
\sifitem{View Factors Fixed After Iterations}{Integer} 
Sometimes the iteration changes the geometry of the radiation
boundaries as an unwanted side-effect. Then the geometry on the radiation 
boundary may be set fixed after some iterations. In practice this is done by adding
suitable Dirichlet conditions in the boundary conditions.
\sifitem{Gebhardt Factors Solver Full}{Logical}
If the view factor matrix is relatively sparse it will make sense
to use a sparse matrix equation for solving the Gebhardt factors.
This flag may be used if a full matrix should be desired.
\sifitem{Gebhardt Factors Solver Iterative}{Logical}
If the Gebhardt factors are solved from a sparse matrix equation 
also the type of solver may be selected. The default is 
direct \texttt{umfpack} solver. Sometimes the memory usage may be a problem
or the direct strategy simply not efficient enough. Then 
an iterative \texttt{cgs} solver may be used instead.
\sifend

\sifitem{Equation}{eq id}
The equation section is used to define a set of equations for a body or set of bodies.
\sifbegin
\sifitem{Heat Equation}{String} If set to {\tt True}, solve the heat equation.
\sifitem{Convection}{String}
The type of convection to be used
in the heat equation, one of: {\tt None}, {\tt Computed}, {\tt Constant}.
\sifitem{Phase Change Model}{String}
One of: {\tt None},~ {\tt Spatial 1},
~{\tt Spatial 2}~ and~ {\tt Temporal}.
Note that when solidification is modelled, the
enthalpy-temperature- and viscosity-temperature-curves must be defined in 
the material section.
\sifend


\sifitem{Body Forces}{bf id} 
The body force section may be used to give additional force terms for the equations.
The following keywords are recognized by the base solver:
\sifbegin
\sifitem{Heat Source}{Real}
An additional heat source $h$ for the heat equation may be given
with this keyword.
\sifitem{Friction Heat}{Logical}
Currently redundant key word, the frictional heating $h_f$ is automatically
added.
\sifitem{Joule Heat}{Logical}
If set {\tt True}, triggers use of the inductive heating.
\sifitem{Smart Heater Control}{Logical}
Sometimes the predescribed heat source does not lead to the desired 
temperature. Often the temperature is controlled by a feedback and therefore
a similar heater control in the simulation may give more realistic results.
This flag makes sets the smart heater control on for the given body force.
\sifend


\sifitem{Initial Condition}{ic id}
The initial condition section may be used to set initial values for temperature.
\sifbegin
\sifitemnt{Temperature}{Real}
\sifend

\sifitem{Material}{mat id}
The material section is used to give the material parameter values. The
following material parameters may be effective when heat equation is solved.
\sifbegin
\sifitem{Density}{Real}
The value of density is given with this keyword. The value may be constant,
or variable. For the compressible flow, the density is computed internally,
and this keyword has no effect.
\sifitem{Enthalpy}{Real} 
Note that, when using the solidification modelling,
an enthalpy-temperature curve must be given. The enthalpy is derived with
respect to temperature to get the value of the effective heat capacity.
\sifitem{Viscosity}{Real} Viscosity is needed if viscous heating 
is taken into account. When using the solidification modelling,
a viscosity-temperature curve must be given. The viscosity must be set
to high enough value in the temperature range for solid material to effectively
set the velocity to zero.
\sifitem{Heat Capacity}{Real}
The value of heat capacity in constant pressure $c_p$ is given
with this keyword. The value may be constant,
or variable. For the phase change model, this value is modified according to
rules given in the theory section.
\sifitem{Heat Conductivity}{Real}
The value of heat conductivity $k$ is given with this keyword. The value may
be a constant or variable.
\sifitem{Convection Velocity i}{Real} 
Convection velocity {\tt i}$=1,2,3$ for the constant convection model.
\sifitem{Compressiblity Model}{Real} This setting may be used to set the compressibilty
model for the flow simulations. Choices are {\tt Incompressible} and {\tt Perfect Gas}.
If set to the latter there may
be mechanical work performed by the heating.
Then also the settings {\tt Reference Pressure} and {\tt Specific Heat Ratio} must also be given.
\sifitem{Reference Pressure}{Real} With this keyword a reference level of pressure may be given.
\sifitem{Specific Heat Ratio}{Real} The ratio of specific heats (in constant pressure
versus in constant volume) may be given with this keyword.
The default value of this setting is $5/3$, which
is the appropriate value for monoatomic ideal gas.
\sifend

\sifitem{Boundary Condition}{bc id}
The boundary condition section holds the parameter values for various
boundary condition types. In heat equation we may set the temperature directly 
by Dirichlet boundary conditions or use different flux conditions for the temperature.
The natural boundary condition of heat equation is zero flux condition.
\sifbegin
\sifitemnt{Temperature}{Real}
\sifitem{Heat Flux BC}{Logical} 
Must be set to {\tt True},  if heat flux boundary
condition is present.
\sifitem{Heat Flux}{Real} A user defined heat flux term.
\sifitem{Heat Transfer Coefficient}{Real}
Defines the parameter $\alpha$ in the heat flux boundary
condition of the type
$$
    -k\frac{\partial T}{\partial n} = \alpha(T-T_{ext}) .
$$
\sifitem{External Temperature}{Real} 
Defines the variable for ambient temperature $T_{ext}$ in the previous equation.
\sifitem{Radiation}{String}
The type of radiation model for this boundary,
one of: {\tt None}, {\tt Idealized}, {\tt Diffuse Gray}. 
Note that, when using the diffuse gray radiation model, the file containing
the Gebhardt factors must be given in the simulation section.
\sifitem{Radiation Boundary}{Integer}
If there are many closures with radiation boundary conditions that do not
see each other the view factors may be computed separately. This keyword
is used to group the boundaries to independent sets. The default is one.
\sifitem{Radiation Boundary Open}{Logical}
The closures may be partially open. Then no normalization of the view factors
is enforced. The missing part of the radiation angle is assumed to be 
ideal radiation. Therefore if this option is enforced also 
the parameter \texttt{External Temperature} must be given. 
\sifitem{Emissivity}{Real}
Emissivity of the radiating surface, required for radiation model is present.
\sifitem{Radiation Target Body}{Integer} 
This flag may be used to set the
direction of the outward pointing normal. This is used when computing viewfactors.
A body identification number must be given.  The default is that the normal points to less
dense material or outward on outer boundaries.
%
\item{Smart Heater Boundary}{Logical}
If the smart heater is activated the point for monitoring the temperature is 
the point with maximum $x$-coordinate on the boundary where this 
keyword is set \texttt{True}. Alternatively the logical variable \texttt{Phase Change}
is looked for. 
\item{Smart Heater Temperature}{Real}
The desired temperature for the smart heater system is set by this keyword. 
Alternatively the real variable \texttt{Melting Point} may be used. 
\sifend
\sifend



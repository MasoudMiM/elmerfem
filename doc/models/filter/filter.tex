\chapter{Filtering time-series data}

\noindent
\modinfo{Module name}{\Idx{FilterTimeSeries}}
\modinfo{Module subroutines}{FilterTimeSeries}
\modinfo{Module authors}{Peter Råback}
\modinfo{Document authors}{Peter Råback}
\modinfo{Document created}{13.2.2008}
\modinfo{Document updated}{13.2.2008}

\section{Introduction}

The module includes auxiliary utilities for 
\Idx{filtering} time-series
data. Supported filters include various averaging
possibilities and \Idx{Fourier series}, for example.
The solver does not introduce any new physics.
However, it may be useful in analyzing time-dependent data to be
used in conjunction with time-harmonic models, or in studying 
phenomena with different timescales (turbulence). 


\section{Theory}


\subsection*{Mean of a function}
The solver is built so that an estimate for the filtered data may be
obtained at all times i.e. the normalizing is done after each timesteps.
As an example let's consider taking a simple mean over a period of time. 
The stating point
is the time averaged mean,
\begin{equation}
  <f>_T=\frac{1}{T} \int_0^T f(t)\, dt .
\end{equation}
Its discrete counterpart assuming piecewise constant integration is
\begin{equation}
  <f>_n=\frac{1}{T_n} \sum_i^n f_i\, dt_i ,
\end{equation}
where $T_n=\sum dt_i$. Now this may be presented inductively as
\begin{eqnarray}
  <f>_n & = & \frac{T_{n-1} <f>_{n-1} + f_n dt_n}{T_{n-1} + dt_n} \\
  T_n & = & T_{n-1} + dt_i .
\end{eqnarray}

\subsection*{Weigted mean}
It's also possible to take a weigted mean with a user defined
function $g(t)$ depending on time only. Then similarly, 
\begin{equation}
  <fg>_n =  \frac{T_{n-1} <fg>_{n-1} + f_n g_n dt_n}{T_{n-1} + dt_n} .
\end{equation}


\subsection*{Fourier series}
Using the weighted mean a starting point its possible to present
the solution in terms of sine and cosine series. 
In order to obtain normalized Fourier series components
the sine and cosine functions are internally defined 
as $2\sin(2\pi w t)$ and $2\cos(2\pi w t)$, where 
$k$ is the degree of the term, and $w$ is the user defined frequency.
After each full cycle the inner product then includes the Fourier 
coefficients
and the transient solution may hence be approximated by 
\begin{equation}
  f \approx \sum_{k=1}^{m_s} s_k \sin(2\pi w t) + \sum_{k=1}^{m_c} c_k \cos(2\pi w t), 
\end{equation}
where $m_s$ and $m_c$ are maximum degrees defined by the user. 

\subsection*{Continous average}
Sometimes it may be usefull that the new solution is given a 
relatively higher weight than the old solution. This is achieved
by relaxing the weight (elapsed time) related to the old solution by
\begin{equation}
  T_{n-1} := T_{n-1} \exp (-dt_n / \tau),
\end{equation} 
where $\tau$ is the time scale when decay to fraction $1/\mbox{e}$ is 
desired. If the decay time is short compared to the overall simulation
time this provides a continous mean that represents only 
the recent results. The fraction of the last timestep in 
solution will always be $dt/\tau$.


\subsection*{Computing variances}

It is not possible to compute the variance directly with one
sweep as computing the variance from the functional values requires
the knowledge of the mean. However, computing the mean of the square of the 
solution enables that the variance is computed a posteriori since the 
following holds for any field variable,
\begin{equation}
  \sigma^2 = <(f-<f>)^2> = < f^2 > - <f>^2.
\end{equation}



\section{Keywords}


\sifbegin
\sifitemnt{Solver}{solver id}
\sifbegin
\sifitemnt{Procedure}{File "FilterTimeSeries"\ "FilterTimeSeries"}
\sifitem{Variable i}{String}
The names of the variables to be filtered. There can in principle 
be up to 99 variables. Note that the keywords with the same 
\texttt{i} form a set which define one filtering. If the 
\texttt{Variable} is not redefined the previously defined variable 
with a lower \texttt{i} is used.
%
\sifitem{Operator i}{String}
Normally the variable is treated as its plain value. There are
however different options for using the field value in a modified
manner. These include \texttt{length} (L2 norm), \texttt{abs}, and
\texttt{square}.
%
\sifitem{Start Time i}{Real}
The start time for perfoming the integration.
Note that for Fourier series this is used to reset the zero 
time i.e. $t:=t-t_0$.
%
\sifitem{Stop Time i}{Real}
The stop time for perfoming the integration.
%
\sifitem{Reset Interval i}{Real}
The time interval at which the computation of a mean is reinitialized.
%
\sifitem{Decay Time i}{Real}
The decay time $\tau$ in computing continous means.
%
\sifitem{Time Filter i}{Real}
The function $g(t)$ that may be used in computing the mean.
%
\sifitem{Sine Series i}{Integer}
The number of terms in the sine series. Note that its possible
to make a Fourier series only if the target variable is a scalar.
Its also possible to have only one sine or cosine series at a time.
%
\sifitem{Cosine Series i}{Integer}
The number of terms in the cosine series.
%
\sifitem{Frequency}{Integer}
If using cosine or sine series the frequency must be given.
\sifend
\sifend


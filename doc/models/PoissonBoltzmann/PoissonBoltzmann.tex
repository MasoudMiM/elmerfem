\chapter{Poisson-Boltzmann Equation}\label{poisson-boltzmann}

\modinfo{Module name}{\Idx{PoissonBoltzmannSolve}}
\modinfo{Module subroutines}{PoissonBoltzmannSolve}
\begin{versiona}
\modinfo{Module authors}{Peter Råback}
\modinfo{Document authors}{Peter Råback}
\modinfo{Document edited}{10.8.2004}


\section{Introduction}

The macroscopic electromagnetic theory is governed by the Maxwell's
equations. In steady state the electric field may usually be solved
from a simple Poisson equation. However, if there are free charges
in the domain that are affected by the electric field the equation
is no longer valid. Also the contribution of the free charges need
to be taken into consideration. 
If the electrostatic force is the 
only force affecting the distribution of the electric charges then the 
potential in the steady-state is given by the 
\Idx{Poisson-Boltzmann equation}~\cite{andelman1995}. 
This equation may find its use in microfluidics and 
electrochemical applications. Note that if the charge distribution is
affected by the flow distribution of the carrier fluid this
equation is no longer valid.


\section{Theory}


The electrostatic equation for the electric potential $\phi$ yields,
\begin{equation}
  -\nabla \cdot \varepsilon \nabla \phi = \rho,
\end{equation}
where $\varepsilon$ is the permittivity of the medium and $\rho$ is the 
charge density. 
Assuming that there is a fixed charge density and
 both positive or negative moving ions
the charge may be written as 
\begin{equation}
  \rho = \rho_0 + e ( z^- n^- + z^+ n^+)
\end{equation} 
where $\rho_0$ is interior charge distribution of fixed positions of all solute charges, and
$e$ is the unit charge of a electron, and $z$ is the 
charge number of the positive or negative ions, and
$n$ is the corresponding ion density.

The electrochemical potential $\mu$ of the ions is defined by
$\mu = e z \phi + k_B T \ln n$, where the first term is the  
electrostatic contribution and the second term comes from the 
entropy of the ions at the weak solution limit. In
equilibrium $\mu_i$ is constant over the whole domain and thus the
ion density obeys a \Idx{Boltzmann distribution},
\begin{equation}
  n = n_{0} \mbox{e}^{-ez\phi / k_B T}
\end{equation}
where $k_B$ is the Boltzmann constant.
Inserting this to the Poisson equation we obtain the 
Poisson-Boltzmann equation that determines the potential
field self-consistently,
\begin{equation}\label{eq:poisson-boltzmann}
    -\nabla \cdot \varepsilon \nabla \phi =  \rho_0 + 
     e z^- n_{0}^- \mbox{e}^{-ez^-\phi / k_B T} + 
     e z^+ n_{0}^+ \mbox{e}^{-ez^+\phi / k_B T} .
\end{equation}


A special case of the equation is obtained if the charge numbers
and the concentrations are equal, 
 $z = -z^- = z^+$ and $n_{0} = n_{0}^- = n_{0}^+$.
Then the equation simplifies to
\begin{equation}
     -\nabla \cdot \varepsilon \nabla \phi =  \rho_0 -
	2 e z n_{0} \sinh (e z \phi / k_B T) .
\end{equation}
The Poisson-Boltzmann equation is obviously nonlinear. 
We will show the iterative procedure only for this case, the 
generic case is dealt similarly.

\subsection{Iteration scheme}

Defining $\alpha = 2 e z n_{0} $ and $\beta = e z / k_B T$ the 
Poisson-Boltzmann equation for a symmetric electrolyte may be 
written as
\begin{equation}
  -\nabla \cdot \varepsilon \nabla \phi =  \rho_0 - \alpha \sinh (\beta \phi ) .
\end{equation}
The straight-forward iterative procedure treats only
the left-hand-side of the equation in an implicit manner,
\begin{equation}
  -\nabla \cdot \varepsilon \nabla \phi^{(n+1)} =  \rho_0 -
\alpha \sinh (\beta \phi^{(n)} ) .
\end{equation}
The convergence of this scheme is, however, quite poor for many 
cases of practical interest. An improved strategy should linearize also
the right-hand-side. 

Making a Taylor's expansion we may approximate
\begin{equation}
\sinh (\beta \phi^{(n+1)}) \approx 
\sinh (\beta \phi^{(n)}) + \beta \cosh (\beta \phi^{(n)})
(\phi^{(n+1)} - \phi^{(n)})
\end{equation}
which results to the Newton iteration scheme
\begin{eqnarray}
  \left [ -\nabla \cdot \varepsilon \nabla 
  + \alpha \beta \cosh (\beta \phi^{(n)}) \right ] \phi^{(n+1)} 
\nonumber \\
  = \rho_0 - \alpha \sinh (\beta \phi^{(n)}) 
  + \alpha \beta \cosh (\beta \phi^{(n)})  \phi^{(n)} .
\end{eqnarray}
This scheme has good convergence properties and is usually the method of choice.

\subsection{Boundary conditions}

For electric potential either Dirichlet or Neumann boundary condition
can be used. The Dirichlet boundary condition gives the value of the
potential on specified boundaries. The Neumann boundary condition is
used to give a flux condition on specified boundaries
\begin{equation}
 \sigma = \varepsilon\nabla\phi\cdot\Vec{n},
\end{equation}
where $\sigma$ is the surface charge density.


\subsection{Derived quanties}

When the potential has been solved the 
electric field may be obtained as a postprocessing step from
\begin{equation}
\Vec{E} = -\nabla \phi. 
\end{equation}

Charge density may be obtained as the right-hand-side of the 
Poisson equation,
\begin{equation}
  \rho = \rho_0 + 
     e z^- n_{0}^- \mbox{e}^{-ez^-\phi / k_B T} + 
     e z^+ n_{0}^+ \mbox{e}^{-ez^+\phi / k_B T} .
\end{equation}
which in symmetric case yields,
\begin{equation}
  \rho = \rho_0 - 2 e z n_{0} \sinh (e z \phi / k_B T) .
\end{equation}

The energy density of the field ay be computed from
\begin{equation}
  e = \frac{1}{2}\Vec{E}\cdot\Vec{D} =  
\frac{1}{2} \varepsilon (\nabla \phi)^2 .
\end{equation}
However, in a more generic treatment also the 
connribution of the concentration should be included in the expression of the 
energy.

%\frac{1}{2} \varepsilon (\nabla \phi)^2 .
%\end{equation}
%Thus the energy of the electric field may be computed from 
%the field is for the moment computed
%\begin{equation}
%  E  = \frac{1}{2}\int_\Omega \varepsilon (\nabla \phi)^2 d\Omega.
%\end{equation}


\section{Notes on output control}

The user can control which derived quantities ({\em i.e.} electric
field and electric energy) are calculated.

There are also available two choices of visualization types for the
derived quantities. The node values can be calculated by taking the
average of the derived values on neighboring elements (constant
weights). This results often in visually good images. The other
possible choice is to weight the average with the size of the
elements, which is more accurate and should be used when some other
variable depends on these derived values. The latter choice is also
the default.


\section{Keywords}
\end{versiona}

\sifbegin
\sifitemnt{Constants}{}
\sifbegin
\sifitemnt{Permittivity Of Vacuum}{Real [8.8542e-12 C$^2$/Nm$^2$]}
\sifitemnt{Boltzmann Constant}{Real [1.3807e-23 J/K]}
\sifitemnt{Unit Charge}{Real [1.60219 C]}
\sifend

\sifitemnt{Equation}{equation id}
\sifbegin
\sifitem{Calculate Electric Energy}{Logical [False]}
Controls whether the electric energy density is written in results
files (default False).
\sifend

\sifitemnt{Solver}{solver id}
\sifbegin
\sifitemnt{Equation}{String Poisson Boltzmann Solver}
\sifitem{Variable}{String Potential}
This may be of any name as far as it is used consistently also elsewhere.
\sifitem{Variable DOFs}{Integer 1}
Degrees of freedom for the potential.
\sifitem{Procedure}{File PoissonBoltzmannSolve PoissonBoltzmannSolve}
Following are listed three keywords with default values for 
output control.
%
\sifitem{Nonlinear System Max Iterations}{Integer}
The maximum number of nonlinear iterations.
%
\sifitem{Nonlinear System Convergence Tolerance}{Real}
The relative error after which the iteration is terminated.
%
\sifitem{Nonlinear System Newton After Iterations}{Integer}
The number of iterations after which Newton iteraration is turned on.
The default is zero which should usually be optimal.
%
\sifitem{Nonlinear System Newton After Tolerance}{Real}
Optional parameter which gives the 
tolerance in error after which Newton iteraration is turned on.
%
\sifitemnt{Calculate Electric Field}{Logical [True]}
\sifitemnt{Calculate Electric Flux}{Logical [True]}
\sifitem{Constant Weights}{Logical [True]}
Used to turn constant weighting on for the results.
\sifend



\sifitemnt{Material}{mat id}
\sifbegin
\sifitem{Relative Permittivity}{Real}
The total permittivity is the product of the relative 
permittivity and the permittivity of vacuum. 
\sifitem{Reference Temperature}{Real}
This keyword is used to give the temperature occuring in the
Boltzmann factor. 
\sifitem{Charge Number}{Integer}
For symmetric cases the charge number. For unsymmetric cases 
one may give separately \texttt{Positive Charge Number}
and \texttt{Negative Charge Number}.
\sifitem{Ion Density}{Integer}
For symmetric cases the original density of ions. For unsymmtric cases 
one may give separately \texttt{Positive Ion Density}
and \texttt{Negative Ion Density}.
\sifend
An alternative set of parameters are also possible which are 
particularly suitable for testing purposes.
These are limited to the 
symmetric case where the potential normalized with the Zeta potential
is solved. Then the permittivities should be set to unity and only
two variables are needed to define the case.
\sifbegin
  \sifitem{Poisson Boltzmann Beta}{Real}
  This keyword gives the ratio of parameter $\beta$ to the 
  the Zeta potential. 
  \sifitem{Poisson Boltzmann Alpha}{Real}
  This keyword gives the parameter $\alpha$   
\sifend

\sifitemnt{Body Force}{bodyforce id}
\sifbegin
\sifitem{Charge Density}{Real}
The fixed charge distribution that is not affected by the electric field.
\sifend

\sifitemnt{Boundary Condition}{bc id}
\sifbegin
\sifitemnt{Potential}{Real}
\sifitem{Electric Flux BC}{Logical}
Must be set to {\tt True} if flux BC is used.
\sifitem{Surface Charge}{Real}
Gives the surface charge for the 
Neumann boundary condition.
\sifend
\sifend

\begin{versiona}
\bibliography{elmerbib}
\bibliographystyle{plain}
\end{versiona}

